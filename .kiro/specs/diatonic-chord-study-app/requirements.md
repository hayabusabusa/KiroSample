# 要件仕様書

## 概要
音楽理論学習補助iOSアプリ - コード名入力によるキーサジェスト機能とダイアトニックコード一覧表示

## プロジェクト詳細（ユーザー入力）
コード名を入力したらキーをサジェストしたり、そのキーに対応したダイアトニックコード一覧を表示するような音楽理論の勉強の補助として利用できるiOSアプリを作成したいです。

## 要件

### 要件1: コード名入力機能
**ユーザーストーリー:** 音楽理論を学習するユーザーとして、コード名を入力できるようにしたい。そうすることで、そのコードが使用される可能性のあるキーを知ることができる。

#### 受け入れ基準
1. WHEN ユーザーがテキストフィールドにコード名（例：C, Am, F7, Bm7b5など）を入力する THEN システムがリアルタイムで入力を認識する
2. WHEN ユーザーが一般的なコード記法（メジャー、マイナー、7th、sus4、dim、augなど）を入力する THEN システムが正しく解析する
3. IF ユーザーが無効なコード名を入力した場合 THEN 適切なエラーメッセージを表示し、有効な入力例を提案する
4. WHEN ユーザーがキーボードの「完了」ボタンをタップする THEN 入力が確定されキーサジェスト機能が実行される

### 要件2: キー自動サジェスト機能
**ユーザーストーリー:** 音楽理論を学習するユーザーとして、入力したコードが含まれる可能性のあるキーの候補を自動で提案してもらいたい。そうすることで、そのコードがどのような調性で使用されるかを理解できる。

#### 受け入れ基準
1. WHEN ユーザーがコード名を入力する THEN システムがそのコードを含む可能性のある全てのキー（長調・短調）をリストアップする
2. WHEN 複数のキー候補が存在する場合 THEN 使用頻度や理論的重要度に基づいて優先順位を付けて表示する
3. WHEN サジェスト結果が表示される THEN 各キーについて「なぜそのキーに含まれるか」の簡潔な説明を表示する
4. IF 入力されたコードがどのキーにも一般的に含まれない場合 THEN 最も近い代替案や借用和音として使用される可能性を表示する

### 要件3: ダイアトニックコード一覧表示機能
**ユーザーストーリー:** 音楽理論を学習するユーザーとして、選択したキーのダイアトニックコード（そのキーに自然に含まれるコード）の完全なリストを見たい。そうすることで、そのキーでの作曲や演奏の参考にできる。

#### 受け入れ基準
1. WHEN ユーザーがサジェストされたキーの中から1つを選択する THEN そのキーの7つのダイアトニックコード（I, ii, iii, IV, V, vi, vii°）を表示する
2. WHEN ダイアトニックコードが表示される THEN 各コードについてローマ数字記法、コード名、機能（トニック、サブドミナント、ドミナントなど）を併記する
3. WHEN メジャーキーが選択された場合 THEN メジャースケールに基づくダイアトニックコードを表示する
4. WHEN マイナーキーが選択された場合 THEN ナチュラルマイナースケールに基づくダイアトニックコードを表示する
5. WHEN ユーザーがダイアトニックコードのリスト内の任意のコードをタップする THEN そのコードを新しい入力として設定し、キーサジェスト機能を再実行する

### 要件4: ユーザーインターフェース要件
**ユーザーストーリー:** モバイルデバイスを使用するユーザーとして、直感的で使いやすいインターフェースでアプリを操作したい。そうすることで、音楽練習中でも素早く情報にアクセスできる。

#### 受け入れ基準
1. WHEN アプリが起動する THEN メインの入力フィールドが画面中央に分かりやすく配置されている
2. WHEN キーボードが表示される THEN アプリのメインコンテンツが適切にリサイズされ、入力フィールドが見える状態を維持する
3. WHEN 結果が表示される THEN スクロール可能で見やすい形式で情報が整理されている
4. WHEN ユーザーがダークモード/ライトモードを切り替える THEN アプリが適切にテーマを変更する
5. WHEN ユーザーがアクセシビリティ機能を使用する THEN VoiceOverや文字サイズ変更に対応している

### 要件5: パフォーマンス要件
**ユーザーストーリー:** 音楽練習中にアプリを使用するユーザーとして、素早いレスポンスでアプリが動作してほしい。そうすることで、練習の流れを中断することなく情報を取得できる。

#### 受け入れ基準
1. WHEN ユーザーがコード名を入力する THEN 1秒以内にキーサジェストが表示される
2. WHEN ユーザーがキーを選択する THEN 0.5秒以内にダイアトニックコードリストが表示される
3. WHEN アプリが起動する THEN 3秒以内にメイン画面が使用可能な状態になる
4. IF ネットワーク接続が不安定な場合でも THEN オフラインで基本機能が動作する

### 要件6: データ精度・信頼性要件
**ユーザーストーリー:** 音楽理論を学習するユーザーとして、正確で信頼できる音楽理論情報を取得したい。そうすることで、正しい知識を身につけることができる。

#### 受け入れ基準
1. WHEN システムがキーサジェストを行う THEN 音楽理論に基づいて正確な結果を表示する
2. WHEN ダイアトニックコードが表示される THEN 各キーに対して理論的に正しいコード進行を表示する
3. WHEN コード記法が解析される THEN 一般的な記法（C, Cm, C7, Cmaj7, Csus4など）を正確に認識する
4. IF エッジケースや特殊なコード（テンションコード、分数コードなど）が入力された場合 THEN 適切な処理を行うか、対応していない旨を明確に表示する

### 要件7: iOS固有要件
**ユーザーストーリー:** iOSデバイスを使用するユーザーとして、iOS特有の機能やガイドラインに準拠したアプリを使用したい。そうすることで、他のiOSアプリと一貫した操作感を得られる。

#### 受け入れ基準
1. WHEN アプリがiOS 17.0以降のデバイスで動作する THEN 全ての機能が正常に動作する
2. WHEN ユーザーがiPhoneとiPadの両方でアプリを使用する THEN 各デバイスサイズに最適化されたレイアウトで表示される
3. WHEN アプリがバックグラウンドから復帰する THEN 前回の状態（入力内容、表示結果など）が保持されている
4. WHEN iOS設定でアプリのテーマ設定が変更される THEN アプリが自動的に対応したテーマに切り替わる